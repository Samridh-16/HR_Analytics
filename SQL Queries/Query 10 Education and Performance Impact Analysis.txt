-- Query 10: Education and Performance Impact Analysis
SELECT 
    EducationField,
    Education as Education_Level,
    PerformanceRating,
    JobInvolvement,
    StockOptionLevel,
    COUNT(*) as Employee_Count,
    SUM(CASE WHEN Attrition = TRUE THEN 1 ELSE 0 END) as Departed_Count,
    ROUND(SUM(CASE WHEN Attrition = TRUE THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as Attrition_Rate,
    ROUND(AVG(MonthlyIncome), 0) as Average_Income,
    ROUND(AVG(YearsAtCompany), 1) as Average_Tenure,
    ROUND(AVG(TrainingTimesLastYear), 1) as Avg_Training_Sessions,
    ROUND(AVG(PerformanceRating + JobInvolvement), 2) as Avg_Performance_Score
FROM `elaborate-art-471212-d9.HR_Employee_attrition.HR_Employee_Attrition_checked`
GROUP BY EducationField, Education, PerformanceRating, JobInvolvement, StockOptionLevel
HAVING COUNT(*) >= 3
ORDER BY Attrition_Rate DESC, Employee_Count DESC;
