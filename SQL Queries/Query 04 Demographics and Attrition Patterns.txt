-- Query 4: Demographics and Attrition Patterns
SELECT 
    CASE 
        WHEN Age < 25 THEN 'Under 25'
        WHEN Age BETWEEN 25 AND 34 THEN '25-34'
        WHEN Age BETWEEN 35 AND 44 THEN '35-44'
        WHEN Age BETWEEN 45 AND 54 THEN '45-54'
        ELSE '55+'
    END as Age_Group,
    Gender,
    MaritalStatus,
    COUNT(*) as Employee_Count,
    SUM(CASE WHEN Attrition = TRUE THEN 1 ELSE 0 END) as Attrition_Count,
    ROUND(SUM(CASE WHEN Attrition = TRUE THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as Attrition_Rate,
    ROUND(AVG(MonthlyIncome), 0) as Average_Income
FROM `elaborate-art-471212-d9.HR_Employee_attrition.HR_Employee_Attrition_checked`
GROUP BY 
    Age_Group,
    Gender,
    MaritalStatus
ORDER BY Attrition_Rate DESC;
